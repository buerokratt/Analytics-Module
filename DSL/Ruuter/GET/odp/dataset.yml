getKey:
  call: http.post
  args:
    url: "[#ANALYTICS_RESQL]:[#ANALYTICS_RESQL_PORT]/get-odp-settings"
  result: settings
  
authenticate:
  call: http.post
  args:
    url: "[#ANALYTICS_OPEN_DATA_SERVICE]/api/auth/key-login"
    headers:
      X-API-KEY: ${settings.response.body[0].odpKey}
  result: apiToken

get_dataset_metadata:
  call: http.get
  args:
    url: "[#ANALYTICS_OPEN_DATA_SERVICE]/api/organizations/my-organization/[#OPEN_DATA_PORTAL_ORGANIZATION_ID]/datasets"
  query:
    datasetId: ${incoming.params.datasetId}  
  result: dataset  

return:
  return: ${dataset.response.body}
